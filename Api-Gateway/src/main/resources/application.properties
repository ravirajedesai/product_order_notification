# ===============================
# Application
# ===============================
spring.application.name=api-gateway
server.port=8085
spring.main.web-application-type=reactive

# ===============================
# Eureka Client Configuration
# ===============================
eureka.client.service-url.defaultZone=http://localhost:8761/eureka
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true

# ===============================
# Spring Cloud Gateway Routes
# ===============================

# -------- ORDER SERVICE --------
spring.cloud.gateway.routes[0].id=order-service
spring.cloud.gateway.routes[0].uri=lb://ORDER-SERVICE
spring.cloud.gateway.routes[0].predicates[0]=Path=/orders,/orders/**
spring.cloud.gateway.routes[0].filters[0].name=CircuitBreaker
spring.cloud.gateway.routes[0].filters[0].args.name=orderServiceCB
spring.cloud.gateway.routes[0].filters[0].args.fallbackUri=forward:/order-fallback

# -------- PRODUCT SERVICE --------
spring.cloud.gateway.routes[1].id=product-service
spring.cloud.gateway.routes[1].uri=lb://PRODUCT-SERVICE
spring.cloud.gateway.routes[1].predicates[0]=Path=/products,/products/**
spring.cloud.gateway.routes[1].filters[0].name=CircuitBreaker
spring.cloud.gateway.routes[1].filters[0].args.name=productServiceCB
spring.cloud.gateway.routes[1].filters[0].args.fallbackUri=forward:/product-fallback

# ===============================
# Resilience4j Circuit Breaker
# ===============================

resilience4j.circuitbreaker.instances.orderServiceCB.register-health-indicator=true
resilience4j.circuitbreaker.instances.orderServiceCB.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.orderServiceCB.sliding-window-size=10
resilience4j.circuitbreaker.instances.orderServiceCB.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.orderServiceCB.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.orderServiceCB.wait-duration-in-open-state=10s

resilience4j.circuitbreaker.instances.productServiceCB.register-health-indicator=true
resilience4j.circuitbreaker.instances.productServiceCB.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.productServiceCB.sliding-window-size=10
resilience4j.circuitbreaker.instances.productServiceCB.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.productServiceCB.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.productServiceCB.wait-duration-in-open-state=10s

# ===============================
# Gateway Timeouts (Recommended)
# ===============================
spring.cloud.gateway.httpclient.connect-timeout=3000
spring.cloud.gateway.httpclient.response-timeout=5s
